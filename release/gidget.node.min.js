/*! gidget-builder 2015-07-30 */
var Hilary=require("hilary");Hilary.scope("gidget").register({name:"IGidget",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidget",GidgetModule:{type:"function",args:["path","callback"]},GidgetRoute:{type:"function",args:["route"]}})}}),Hilary.scope("gidget").register({name:"IGidgetApp",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetApp",start:"function",routeEngine:"object",pipelines:"object",registerModule:{type:"function",args:["gidgetModule"]},registerModules:{type:"function",args:["gidgetModules"]}})}}),Hilary.scope("gidget").register({name:"IGidgetModule",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetModule",get:"object",post:"object",put:"object",del:"object",any:"object"})}}),Hilary.scope("gidget").register({name:"IGidgetRoute",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetRoute",routeHandler:"function"})}}),Hilary.scope("gidget").register({name:"IRouteEngine",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IRouteEngine",get:{type:"function",args:["path","callback"]},post:{type:"function",args:["path","callback"]},put:{type:"function",args:["path","callback"]},del:{type:"function",args:["path","callback"]},navigate:{type:"function",args:["path","data","pushStateToHistory"]},beforeRouteResolution:{type:"function",args:["callback"]},afterRouteResolution:{type:"function",args:["callback"]},before:{type:"function",args:["callback"]},after:{type:"function",args:["callback"]},onError:{type:"function",args:["callback"]},start:"function",resolveRoute:{type:"function",args:["path"]},resolveAndExecuteRoute:{type:"function",args:["path"]}})}}),Hilary.scope("gidget").register({name:"locale",factory:{errors:{requiresArguments:"The {func} function requires arguments {args}",status404:"Not Found!",interfaces:{requiresImplementation:"A valid implementation is required to create a new instance of an interface",requiresProperty:"The implementation is missing a required property: ",requiresArguments:"The implementation of this function requires the arguments: ",notAnIRouteEngine:"The router instance that was passed into the RouteEngine constructor does not implement IRouteEngine",notAnIGidgetApp:"The gidgetApp instance that were passed into the GidgetApp constructor does not implement IGidgetApp",notAnIGidgetModule:"The module that you are trying to register does not implement IGidgetModule",missingOptions:"To create a Gidget instance, you must provide the minimum required options"}}}}),Hilary.scope("gidget").register({name:"argumentValidator",dependencies:["locale","exceptions"],factory:function(a,b){"use strict";return{validate:function(a,c){var d,e=a.syncSignatureMatches(c);if(e.result)return!0;for(d=0;d<e.errors.length;d+=1)b.throwArgumentException(e.errors[d]);return e}}}}),Hilary.scope("gidget").register({name:"ExceptionHandler",dependencies:[],factory:function(a){"use strict";var b,c={makeException:void 0,argumentException:void 0,throwArgumentException:void 0,notImplementedException:void 0,throwNotImplementedException:void 0,fetchException:void 0,throwFetchException:void 0,throwException:void 0,"throw":void 0};return a="function"==typeof a?a:function(a){throw console.error(a),a},b=function(a,b,c){var d,e;return"object"==typeof a&&"string"==typeof a.message?(d=a.message,e=a):(d="string"==typeof b?b:a,e=new Error(d)),e.message=d,a!==d&&(e.name=a),c&&(e.data=c),e},c.makeException=b,c.argumentException=function(a,c,d){var e="undefined"==typeof c?a:a+" (argument: "+c+")";return b("ArgumentException",e,d)},c.throwArgumentException=function(a,b,d){c["throw"](c.argumentException(a,b,d))},c.notImplementedException=function(a,c){return b("NotImplementedException",a,c)},c.throwNotImplementedException=function(a,b){c["throw"](c.notImplementedException(a,b))},c.fetchException=function(a){return a=a||{},a.status=a.status||"unknown",b("FetchException","Server Request Failed with status: "+a.status,a)},c.throwFetchException=function(a){throw c["throw"](c.fetchException(a)),new Error("Server Request Failed with status: "+a.status)},c.throwException=function(a){c["throw"](a)},c["throw"]=function(c){a("string"==typeof c?b(c):c)},c}}),Hilary.scope("gidget").register({name:"GidgetApp",dependencies:["IGidgetModule","argumentValidator","is"],factory:function(a,b,c){"use strict";var d=function(d){var e={start:void 0,pipelines:{},registerModule:void 0,registerModules:void 0};return e.start=d.start,e.routeEngine=d,e.pipelines.beforeRouteResolution=d.beforeRouteResolution,e.pipelines.afterRouteResolution=d.afterRouteResolution,e.pipelines.before=d.before,e.pipelines.after=d.after,e.pipelines.onError=d.onError,e.registerModule=function(c){if(b.validate(a,c)){var e,f,g,h,i=c.get,j=c.put,k=c.posts,l=c.dels;for(e in i)i.hasOwnProperty(e)&&d.get(e,i[e]);for(f in j)j.hasOwnProperty(f)&&d.put(f,j[f]);for(g in k)k.hasOwnProperty(g)&&d.post(g,k[g]);for(h in l)l.hasOwnProperty(h)&&d.del(h,l[h])}},e.registerModules=function(a){if(c.array(a)){var b;for(b=0;b<a.length;b+=1)e.registerModule(a[b])}},e};return d}}),Hilary.scope("gidget").register({name:"GidgetContext",factory:function(){"use strict";return function(a){var b=this;a=a||{},b.verb=a.verb,b.route=a.route,b.params=a.params}}}),Hilary.scope("gidget").register({name:"GidgetModule",dependencies:[],factory:function(){"use strict";return function(){var a={};return a.get={},a.post={},a.put={},a.del={},a.any={},a}}}),Hilary.scope("gidget").register({name:"GidgetRoute",dependencies:["IGidgetRoute","argumentValidator"],factory:function(a,b){"use strict";return function(c){if(b.validate(a,c)){var d=c.routeHandler;return"function"==typeof c.before&&(d.before=c.before),"function"==typeof c.after&&(d.after=c.after),d}}}}),Hilary.scope("gidget").register({name:"BaseRouteEngine",dependencies:["Route","GidgetContext","is","locale","exceptions"],factory:function(a,b,c,d,e){"use strict";var f=function(f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=[];return f=f||{},g={get:f.get,post:f.post,put:f.put,del:f.del,navigate:f.navigate,beforeRouteResolution:void 0,afterRouteResolution:void 0,before:void 0,after:void 0,onError:void 0,parseRoute:void 0,resolveRoute:void 0,resolveAndExecuteRoute:void 0,start:f.start},h={escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g,namedParam:/:(\w+)/g,splatParam:/\*(\w+)/g,firstParam:/(:\w+)|(\*\w+)/,allParams:/(:|\*)\w+/g,extractHash:/^[^#]*(#.*)$/},i={beforeRouteResolution:[],afterRouteResolution:[],before:[],after:[],error:[]},j=function(a){if(c["function"](a)&&a.length<3){var b=function(b,c,d){a(b,c),d(b,c)};return b.before=j(a.before),b.after=j(a.after),b}return a},k=function(a,d,e){return function(d,f){var g,h,i,j,k;g=function(){var d=new b({verb:a,route:f,params:f.params});c["function"](e.before)?e.before(null,d,h):h(null,d)},h=function(a,b){q(a,b,i)},i=function(a,b){e(a,b,j)},j=function(a,b){c["function"](e.after)?e.after(a,b,k):k(a,b)},k=function(a,b){r(a,b)},g()}},l=function(a,b,f){(c.not.defined(b)||c.not["function"](f))&&e.throwArgumentException(d.errors.requiresArguments.replace("{func}","addRoute").replace("{args}","(verb, path, callback)")),v.push({route:m(b),callback:k(a,b,j(f))})},m=function(b,c){var d,e,f,g;return g=String(b),e=g.match(h.allParams),f=null!==e?function(){var a,b,c;for(c=[],a=0,b=e.length;b>a;a+=1)d=e[a],c.push(d.substr(1));return c}():[],g=g.replace(h.escapeRegExp,"\\$&"),g=g.replace(h.namedParam,"([^/]+)"),g=g.replace(h.splatParam,"(.+?)"),new a({expressionString:g,paramNames:f,path:b},c)},n=function(a,b){var d,e,f={};if(d=a.match(b.expression),c.not.array(d)||1===d.length)return f.splat=[],f;for(d.shift(),f.splat=d,e=0;e<b.paramNames.length;e+=1)f[b.paramNames[e].replace(/:/g,"")]=f.splat[e];return f},g.get=g.get||function(a,b){return l("get",a,b)},g.post=g.post||function(a,b){return l("post",a,b)},g.put=g.put||function(a,b){return l("put",a,b)},g.del=g.del||function(a,b){return l("del",a,b)},p=function(a){return c.not["function"](a)?(s({status:500,message:"A callback function is required to regiseter a pipeline event"}),!1):!0},g.beforeRouteResolution=function(a){p(a)&&(a.length<2?i.beforeRouteResolution.push(function(b,c){a(b),c(null,b)}):i.beforeRouteResolution.push(a))},g.afterRouteResolution=function(a){p(a)&&(a.length<3?i.afterRouteResolution.push(function(b,c,d){a(b,c),d(null,c)}):i.afterRouteResolution.push(a))},g.before=function(a){p(a)&&(a.length<3?i.before.push(function(b,c,d){a(b,c),d(null,c)}):i.before.push(a))},g.after=function(a){p(a)&&i.after.push(a)},g.onError=function(a){p(a)&&i.error.push(a)},o=function(a,b){var d,e=[],f=function(d){return function(e,g){a.length===d?c["function"](b)&&b(e,g):a[d](e,g,f(d+1))}};for(d=0;d<a.length;d+=1)e.push(f(d));return e},q=function(a,b,c){var d=o(i.before,c);d.length?d[0](a,b):c(null,b)},r=function(a,b){var c=o(i.after);c.length&&c[0](a,b)},s=function(a){var b;for(b=0;b<i.error.length;b+=1)i.error[b](a)},t=function(a,b){var c=o(i.beforeRouteResolution,b);c.length?c[0](null,a):b(null,a)},u=function(a,b){var c=o(i.afterRouteResolution,b);c.length?c[0](null,a):b(null,a)},g.resolveRoute=function(a){var b,c;for(b=0;b<v.length;b+=1)if(v[b].route.expression.test(a)){c=v[b];break}return c?(c.params=n(a,c.route),c):!1},g.resolveAndExecuteRoute=function(a){var b,e,f,h;b=function(){t(a,e)},e=function(a,b){return a?void s(a):(h=g.resolveRoute(b),void(h===!1?(a={status:404,message:d.errors.status404,path:b},s(a)):c["function"](h.callback)&&f(h)))},f=function(a){u(a,a.callback)},b()},g};return f}}),function(a,b){"use strict";a.scope("gidget").register({name:"DefaultRouteEngine",dependencies:["BaseRouteEngine","is"],factory:function(a,c){var d,e,f,g;return d=function(){f(),e()},e=function(){g.navigate(location.href)},f=function(){document.addEventListener("click",function(a){c.string(a.target.localName)&&"a"===a.target.localName&&(a.preventDefault(),g.navigate(a.target.href))},!1),window.addEventListener("popstate",function(a){c.string(a.state)?(a.preventDefault(),g.navigate(a.state,null,!1)):c.object(a.state)&&c.defined(a.state.path)&&(a.preventDefault(),g.navigate(a.state.path))},!1)},g=new a({start:d}),g.navigate=function(a,d,e){var f=d||{};if(c.not.defined(e)&&(e=!0),c.string(a.host)&&a.host===document.location.host)f.path=a,f.relativePath=a.pathname+a.search+a.hash,f.title=window.title;else{if(!c.string(a)||-1!==a.replace(window.location.origin,"").indexOf("http"))return void(window.location=a);f.path=a,f.relativePath=a.replace(window.location.origin,""),f.title=window.title}e&&b.pushState(f.path,f.title,f.relativePath),g.resolveAndExecuteRoute(f.relativePath)},g}})}(Hilary,window.history),Hilary.scope("gidget").register({name:"DefaultGidgetBootstrapper",dependencies:["is"],factory:function(a){"use strict";var b=function(b,c){var d,e,f={compose:void 0,start:void 0,configureRoutes:void 0,configureApplicationContainer:void 0,configureApplicationLifecycle:void 0};return a.defined(b)&&b.register?d=b:e=b,c=e||c||{},c=c||{},f.compose=function(b){a["function"](c.compose)?c.compose(b):b(null,new Gidget)},f.start=function(b,d){f.configureApplicationContainer(d),f.configureApplicationLifecycle(d,d.pipelines),f.configureRoutes(d),a["function"](c.start)&&c.start(b,d),d.start()},f.configureApplicationContainer=function(b){d&&(d.register({name:"gidgetApp",factory:function(){return b}}),d.register({name:"gidgetRouter",factory:function(){return b.routeEngine}}),d.register({name:"application",factory:function(){return{compose:f.compose,start:f.start,restart:function(){f.compose(f.start)}}}})),a["function"](c.configureApplicationContainer)&&c.configureApplicationContainer(b)},f.configureApplicationLifecycle=function(b,d){a["function"](c.configureApplicationLifecycle)&&c.configureApplicationLifecycle(b,d)},f.configureRoutes=function(b){a["function"](c.configureRoutes)&&c.configureRoutes(b)},f.compose(f.start),f};return b}}),Hilary.scope("gidget").register({name:"Route",factory:function(){"use strict";return function(a,b){var c=this,d=b?"":"i";a=a||{},c.expression=new RegExp("^"+a.expressionString+"/?$",d),c.expressionString=a.expressionString,c.paramNames=a.paramNames,c.params=a.params,c.path=String(a.path)}}}),function(a,b,c){"use strict";var d,e;d=function(c){var f;b.register({name:"application",factory:function(){return{compose:d,start:e}}}),b.register({name:"Blueprint",factory:function(){return a.Blueprint}}),b.register({name:"is",factory:function(){return b.getContext().is}}),b.register({name:"exceptions",dependencies:["ExceptionHandler"],factory:function(a){return f||(f=new a(function(a){throw a.data?console.log(a.message,a.data):console.log(a.message),a})),f}}),b.register({name:"Gidget",blueprint:"IGidget",dependencies:["IRouteEngine","GidgetModule","GidgetRoute","DefaultGidgetBootstrapper","GidgetApp","argumentValidator"],factory:function(a,c,d,e,f,g){var h=function(c){return c=c||{},c.routeEngine=c.routeEngine||b.resolve("DefaultRouteEngine"),g.validate(a,c.routeEngine)?new f(c.routeEngine):void 0};return h.GidgetModule=c,h.GidgetRoute=d,h.Bootstrapper=e,h}}),c()},e=function(){var a=b.resolve("Gidget");c.Gidget=a},d(e)}(Hilary,Hilary.scope("gidget"),"undefined"!=typeof module&&module.exports?module.exports:window);