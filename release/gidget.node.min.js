/*! gidget-builder 2015-07-29 */
var Hilary=require("hilary");Hilary.scope("gidget").register({name:"IGidget",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidget",GidgetModule:{type:"function",args:["path","callback"]},GidgetRoute:{type:"function",args:["route"]}})}}),Hilary.scope("gidget").register({name:"IGidgetApp",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetApp",start:"function",pipelines:"object",registerModule:{type:"function",args:["gidgetModule"]},registerModules:{type:"function",args:["gidgetModules"]}})}}),Hilary.scope("gidget").register({name:"IGidgetModule",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetModule",get:"object",post:"object",put:"object",del:"object",any:"object"})}}),Hilary.scope("gidget").register({name:"IGidgetRoute",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetRoute",routeHandler:"function"})}}),Hilary.scope("gidget").register({name:"IRouteEngine",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IRouteEngine",get:{type:"function",args:["path","callback"]},post:{type:"function",args:["path","callback"]},put:{type:"function",args:["path","callback"]},del:{type:"function",args:["path","callback"]},navigate:{type:"function",args:["path","data","pushStateToHistory"]},before:{type:"function",args:["callback"]},after:{type:"function",args:["callback"]},start:"function",resolveRoute:{type:"function",args:["path"]}})}}),Hilary.scope("gidget").register({name:"locale",factory:{errors:{requiresArguments:"The {func} function requires arguments {args}",interfaces:{requiresImplementation:"A valid implementation is required to create a new instance of an interface",requiresProperty:"The implementation is missing a required property: ",requiresArguments:"The implementation of this function requires the arguments: ",notAnIRouteEngine:"The router instance that was passed into the RouteEngine constructor does not implement IRouteEngine",notAnIGidgetApp:"The gidgetApp instance that were passed into the GidgetApp constructor does not implement IGidgetApp",notAnIGidgetModule:"The module that you are trying to register does not implement IGidgetModule",missingOptions:"To create a Gidget instance, you must provide the minimum required options"}}}}),Hilary.scope("gidget").register({name:"argumentValidator",dependencies:["locale","exceptions"],factory:function(a,b){"use strict";return{validate:function(a,c){var d,e=a.syncSignatureMatches(c);if(e.result)return!0;for(d=0;d<e.errors.length;d+=1)b.throwArgumentException(e.errors[d]);return e}}}}),Hilary.scope("gidget").register({name:"ExceptionHandler",dependencies:[],factory:function(a){"use strict";var b,c={makeException:void 0,argumentException:void 0,throwArgumentException:void 0,notImplementedException:void 0,throwNotImplementedException:void 0,fetchException:void 0,throwFetchException:void 0,throwException:void 0,"throw":void 0};return a="function"==typeof a?a:function(a){throw console.error(a),a},b=function(a,b,c){var d,e;return"object"==typeof a&&"string"==typeof a.message?(d=a.message,e=a):(d="string"==typeof b?b:a,e=new Error(d)),e.message=d,a!==d&&(e.name=a),c&&(e.data=c),e},c.makeException=b,c.argumentException=function(a,c,d){var e="undefined"==typeof c?a:a+" (argument: "+c+")";return b("ArgumentException",e,d)},c.throwArgumentException=function(a,b,d){c["throw"](c.argumentException(a,b,d))},c.notImplementedException=function(a,c){return b("NotImplementedException",a,c)},c.throwNotImplementedException=function(a,b){c["throw"](c.notImplementedException(a,b))},c.fetchException=function(a){return a=a||{},a.status=a.status||"unknown",b("FetchException","Server Request Failed with status: "+a.status,a)},c.throwFetchException=function(a){throw c["throw"](c.fetchException(a)),new Error("Server Request Failed with status: "+a.status)},c.throwException=function(a){c["throw"](a)},c["throw"]=function(c){a("string"==typeof c?b(c):c)},c}}),Hilary.scope("gidget").register({name:"GidgetApp",dependencies:["IGidgetModule","argumentValidator","is"],factory:function(a,b,c){"use strict";var d=function(d){var e={start:void 0,pipelines:{},registerModule:void 0,registerModules:void 0};return e.start=d.start,e.pipelines.before=d.before,e.pipelines.after=d.after,e.registerModule=function(c){if(b.validate(a,c)){var e,f,g,h,i=c.get,j=c.put,k=c.posts,l=c.dels;for(e in i)i.hasOwnProperty(e)&&d.get(e,i[e]);for(f in j)j.hasOwnProperty(f)&&d.put(f,j[f]);for(g in k)k.hasOwnProperty(g)&&d.post(g,k[g]);for(h in l)l.hasOwnProperty(h)&&d.del(h,l[h])}},e.registerModules=function(a){if(c.array(a)){var b;for(b=0;b<a.length;b+=1)e.registerModule(a[b])}},e};return d}}),Hilary.scope("gidget").register({name:"GidgetModule",dependencies:[],factory:function(){"use strict";return function(){var a={};return a.get={},a.post={},a.put={},a.del={},a.any={},a}}}),Hilary.scope("gidget").register({name:"GidgetRoute",dependencies:["IGidgetRoute","argumentValidator"],factory:function(a,b){"use strict";return function(c){if(b.validate(a,c)){var d=c.routeHandler;return"function"==typeof c.before&&(d.before=c.before),"function"==typeof c.after&&(d.after=c.after),d}}}}),Hilary.scope("gidget").register({name:"BaseRouteEngine",dependencies:["is","locale","exceptions"],factory:function(a,b,c){"use strict";var d=function(d){var e,f,g,h,i,j,k,l=[];return d=d||{},e={get:d.get,post:d.post,put:d.put,del:d.del,navigate:d.navigate,before:d.before,after:d.after,executeBeforePipeline:void 0,executeAfterPipeline:void 0,parseRoute:void 0,resolveRoute:void 0,start:d.start},f={escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g,namedParam:/:(\w+)/g,splatParam:/\*(\w+)/g,firstParam:/(:\w+)|(\*\w+)/,allParams:/(:|\*)\w+/g,extractHash:/^[^#]*(#.*)$/},g={before:[],after:[]},h=function(a,b,c,d,e){var f;for(f=0;f<a.length;f+=1)a[f](b,c,d,e)},i=function(d,f,g){var h,i;(a.not.defined(f)||a.not["function"](g))&&c.throwArgumentException(b.errors.requiresArguments.replace("{func}","addRoute").replace("{args}","(verb, path, callback)")),i=j(f),h=function(b){var c=!0;a["function"](g.before)&&(c=g.before(b)),c!==!1&&(e.executeBeforePipeline(d,f,b),c=g(b),c!==!1&&(a["function"](g.after)&&(c=g.after(b)),c!==!1&&e.executeAfterPipeline(d,f,b)))},l.push({route:i,callback:h})},j=function(a,b){var c,d,e,g;return a=String(a),e=a.match(f.allParams),g=null!==e?function(){var a,b,c;for(c=[],a=0,b=e.length;b>a;a+=1)d=e[a],c.push(d.substr(1));return c}():[],a=a.replace(f.escapeRegExp,"\\$&"),a=a.replace(f.namedParam,"([^/]+)"),a=a.replace(f.splatParam,"(.+?)"),c=b?"":"i",{expression:new RegExp("^"+a+"/?$",c),params:g,pattern:a}},k=function(b,c){var d,e,f={};if(d=b.match(c.expression),a.not.array(d)||1===d.length)return f.splat=[],f;for(d.shift(),f.splat=d,e=0;e<c.params.length;e+=1)f[c.params[e].replace(/:/g,"")]=f.splat[e];return f},e.get=e.get||function(a,b){return i("get",a,b)},e.post=e.post||function(a,b){return i("post",a,b)},e.put=e.put||function(a,b){return i("put",a,b)},e.del=e.del||function(a,b){return i("del",a,b)},e.before=e.before||function(a){"function"==typeof a&&g.before.push(a)},e.after=e.after||function(a){"function"==typeof a&&g.after.push(a)},e.executeBeforePipeline=function(a,b,c,d){h(g.before,a,b,c,d)},e.executeAfterPipeline=function(a,b,c,d){h(g.after,a,b,c,d)},e.parseRoute=j,e.resolveRoute=function(a){var b,c;for(b=0;b<l.length;b+=1)if(l[b].route.expression.test(a)){c=l[b];break}return c?(c.params=k(a,c.route),c):!1},e};return d}}),function(a,b){"use strict";a.scope("gidget").register({name:"DefaultRouteEngine",dependencies:["BaseRouteEngine","is"],factory:function(a,c){var d,e,f,g;return d=function(){f(),e()},e=function(){g.navigate(location.href)},f=function(){document.addEventListener("click",function(a){c.string(a.target.localName)&&"a"===a.target.localName&&(a.preventDefault(),g.navigate(a.target.href))},!1),window.addEventListener("popstate",function(a){c.string(a.state)?(a.preventDefault(),g.navigate(a.state,null,!1)):c.object(a.state)&&c.defined(a.state.path)&&(a.preventDefault(),g.navigate(a.state.path))},!1)},g=new a({start:d}),g.navigate=function(a,d,e){var f,h=d||{};if(c.not.defined(e)&&(e=!0),c.string(a.host)&&a.host===document.location.host)h.path=a,h.relativePath=a.pathname+a.search+a.hash,h.title=window.title;else{if(!c.string(a)||-1!==a.replace(window.location.origin,"").indexOf("http"))return void(window.location=a);h.path=a,h.relativePath=a.replace(window.location.origin,""),h.title=window.title}e&&b.pushState(h.path,h.title,h.relativePath),f=g.resolveRoute(h.relativePath),c["function"](f.callback)&&f.callback(f.params)},g}})}(Hilary,window.history),Hilary.scope("gidget").register({name:"DefaultGidgetBootstrapper",dependencies:["is"],factory:function(a){"use strict";var b=function(b,c){var d={compose:void 0,start:void 0,configureRoutes:void 0,configureApplicationContainer:void 0,configureApplicationLifecycle:void 0};return c=c||{},d.compose=function(b){a["function"](c.compose)?c.compose(b):b(null,new Gidget)},d.start=function(b,e){d.configureApplicationContainer(e),d.configureApplicationLifecycle(e,e.pipelines),d.configureRoutes(e),a["function"](c.start)&&c.start(b,e),e.start()},d.configureApplicationContainer=function(e){b.register({name:"application",factory:function(){return{compose:d.compose,start:d.start,restart:function(){d.compose(d.start)}}}}),a["function"](c.configureApplicationContainer)&&c.configureApplicationContainer(e)},d.configureApplicationLifecycle=function(b,d){a["function"](c.configureApplicationLifecycle)&&c.configureApplicationLifecycle(b,d)},d.configureRoutes=function(b){a["function"](c.configureRoutes)&&c.configureRoutes(b)},d.compose(d.start),d};return b}}),function(a,b,c){"use strict";var d,e;d=function(c){var f;b.register({name:"application",factory:function(){return{compose:d,start:e}}}),b.register({name:"Blueprint",factory:function(){return a.Blueprint}}),b.register({name:"is",factory:function(){return b.getContext().is}}),b.register({name:"exceptions",dependencies:["ExceptionHandler"],factory:function(a){return f||(f=new a(function(a){throw a.data?console.log(a.message,a.data):console.log(a.message),a})),f}}),b.register({name:"Gidget",blueprint:"IGidget",dependencies:["IRouteEngine","GidgetModule","GidgetRoute","DefaultGidgetBootstrapper","GidgetApp","argumentValidator"],factory:function(a,c,d,e,f,g){var h=function(c){return c=c||{},c.routeEngine=c.routeEngine||b.resolve("DefaultRouteEngine"),g.validate(a,c.routeEngine)?new f(c.routeEngine):void 0};return h.GidgetModule=c,h.GidgetRoute=d,h.Bootstrapper=e,h}}),c()},e=function(){var a=b.resolve("Gidget");c.Gidget=a},d(e)}(Hilary,Hilary.scope("gidget"),"undefined"!=typeof module&&module.exports?module.exports:window);